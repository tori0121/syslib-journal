# Server Setup Documentation Overview

A LAMP stack stands for Linux, Apache, MySQL, and PHP — a set of open source software components that form a website. 

1. Linux -> The OS
2. Apache -> The web server
3. MySQL -> The database management system
4. PHP -> The server-side programming language. 

## Apache
To set up the LAMP stack, we started by installing Apache on our virtual machines (VMs). It should be noted that before installing these systems or using them, we updated our VMs using “sudo apt update” and “sudo apt -y upgrade”. To install apache, we used the command “sudo apt install apache2” after confirming it was the correct package with “apt show apache2”. Sudo acts as the superuser or root user allowing us to make changes that might be blocked otherwise. 

From here, we use the “systemctl status apache2” command to ensure apache is enabled and running, which mine were. Now we can make a webpage! I used w3m and installed it using the “sudo apt install w3m” command and tested it using the “w3m localhost” command and then checking on the external link via my VM. Going into the document root (“cd /var/www/html/”), we then backed-up the index.html file (“sudo mv index.html index.html.original”) and edited it using “sudo nano index.html” to change how our web page looked. 

## PHP
For PHP, we had to install and configure it to work with our servers. For this, we installed two packages using the “sudo apt install php libapache2-mod-php” command. This also allows us to connect Apache and PHP. We confirmed the installation with “php -v” and then confirmed Apache was also error-free using “systemctl status apache2”. Then we created a PHP root file using “cd /var/www/html/” and “sudo nano info.php” which we edited so that the index.php file information would appear in the external link on our VMs. Because this contained sensitive information, we deleted it after setting it up using “sudo rm /var/www/html/info.php”. 

From here, we edited the directory configuration file — but not before making a backup file using “sudo cp dir.conf dir.conf.bak”. To edit the file so index.php is first and then followed by index.html, we used “sudo nano dir.conf”. Because we made a configuration change, we checked for errors using “apachectl configtest” and then reloaded Apache once more using the following commands: “sudo systemctl reload apache2” and “sudo systemctl restart apache2”. Now we can make our PHP page. We went back to the root using “cd /var/www/html/” and then used “sudo nano index.php” to edit the code so it will say what browser and OS are being used by the client.  

## MySQL
Like the other components, we have to install MySQL. We do this using the “sudo apt install mysql-server” command which installs the latest version of MySQL. To check the status and confirm our version is correct we use “apt policy mysql-server” followed by “mysql --version”. To ensure the server is running, we used the command “systemctl status mysql” which said the server was loaded and active for me. After this, we use “sudo mysql_secure_installation” to create a secure baseline. This requires some permissions. After that, we log-in to the database using “sudo mysql -u root”. MySQL uses mysql> to show that we are its command line and all commands end with a semi-colon. 

From here, we established a regular user account. We begin by logging back into the MySQL root (“sudo mysql -u root”) and then create a new user using “create user 'opacuser'@'localhost' identified by 'password here';” We then created a database for this account using “create database opacdb default character set utf8mb4 collate utf8mb4_unicode_ci;” which has also been configured to support international characters. We then grant this database all permissions using “grant all privileges on opacdb.* to 'opacuser'@'localhost' with grant option;” 

Now to get into the nitty-gritty of the work. To make our client more informative, we use “nano .bashrc” and “export MYSQL_PS1="[\d]>” ” to include information/data about MySQL. We also configured our user to have to sign in via password using “mysql -u opacuser -p”. From here, we created a table that included a list of library books and their related metadata. This command is much longer than any other I’ve done and goes: “create table books (id int unsigned not null auto_increment, author varchar(150) not null, title varchar(150) not null, copyright year(4) not null, primary key (ID) );” I confirmed this using the “show tables;” command and added records to this table using: “insert into books (author, title, copyright) values ('Jennifer Egan', 'The Candy House', '2022'), ('Imbolo Mbue', 'How Beautiful We Were', '2021'), ('Lydia Millet', 'A Children\'s Bible', '2020'), ('Julia Phillips', 'Disappearing Earth', '2019');” From here, we can use several different commands to retrieve records, delete records, and alter the structure. 

After this, we finalize the connection between PHP and MySQL. We used “sudo apt install php-mysql php-mysqli” and then restarted Apache once more. We then authenticate MySQL using “cd /var/www” and then “sudo touch login.php”. Then we change the ownership of the file so we don’t share sensitive information, like passwords using “sudo chmod 640 login.php”, “sudo chown :www-data login.php” and “ls -l login.php” This changes the permission settings, allowing the owner to read/write, group owner to read only, and removes permissions from everyone else. Finally, we use “sudo nano login.php” to add our credentials and then create a PHP file for our website. For that, we go back into the Apache root and use “sudo nano opac.php” to insert the code for our table/basic OPAC. To ensure there are no errors, we use “sudo php -f /var/www/login.php” which should return nothing in working order (which mine did not return anything) and then we use “sudo php -f /var/www/html/opac.php” which returns HTML information. We should be able to see our OPAC from here! (still struggling with this, but not getting an error message so not sure why!) 

## Issues
The major issue I encountered was an error reading: "Could not get lock /var/lib/apt/lists/lock. It is held by process 1015 (noble)" While I couldn't figure out what this meant, I did know that I was locked from making changes in my terminal. I ended up browsing some reddit threads and found a suggestion: "sudo fuser -vik -TERM /var/lib/apt/lists/lock" and that did work but then went I went to reboot my VM later, my VM refused to connect. I troubleshooted this through Google Cloud, but once again had to re-establish my VM. 

Another issue has been forgetting ";" at the end of mysql commands, but this has been pretty easy to rectify even though it takes me a few minutes of staring at what I've typed before it clicks. 

Finally, I'm struggling with MySQL information rendering on my website. I've gone back over my commands and files, but I'm not getting an error so I'm hoping the Teams discussion might have some advice. 
